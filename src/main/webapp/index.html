<!DOCTYPE html>
<html lang="en">
<head>
    <title>Three Of A Crime</title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
    <style type="text/css">
        body {
            margin-top: 20px;
        }
    </style>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#suspects").change(function () {
                checkSubmit();
            });

            $("#matches").change(function () {
                checkSubmit();
            });

            $("#clear").click(function () {
                $("#suspects :checked").each(function () {
                    $(this).removeAttr("checked");
                });
                checkSubmit();
            });

            $("#resetGame").on("click", function (e) {
                $("#confirm")
                        .modal({backdrop: "static", keyboard: false})
                        .one("click", "#reset", function (e) {
                            $.get("/play");
                            $("#clear").click();
                            clearResults();
                        });
            });

            $("#submit").click(function () {
                $.ajax({
                    type: 'POST',
                    url: '/play',
                    data: {
                        "matchedSuspects": $("#suspects :checked").map(function () {
                            return $(this).val();
                        }).get(),
                        "matches": $("#matches :checked").val()
                    },
                    dataType: "json",
                    success: displaySuspects,
                });
            });
        });

        function displaySuspects(data, status, jqXHR) {
            clearResults();
            var suspectCards = data.suspectCards;
            $.each(suspectCards, function (index) {
                addSuspectCard(suspectCards[index]);
            });

            var innocentSuspects = data.innocentSuspects;
            $.each(innocentSuspects, function (index) {
                disableSuspect(innocentSuspects[index]);
            });

            $("#clear").click();
        }

        function checkSubmit() {
            if ($("#suspects :checked").length == 3) {
                $("#suspects :not(:checked)").each(function () {
                    $(this).attr("disabled", true);
                });
                if ($("#matches :checked").length > 0) {
                    $("#submit").removeAttr("disabled");
                }
            } else {
                $("#submit").attr("disabled", true);
                $("#suspects :not(:checked)").each(function () {
                    $(this).removeAttr("disabled");
                });
            }
        }

        function displaySuspects(data, status, jqXHR) {
            clearResults();
            var suspectCards = data.suspectCards;
            $.each(suspectCards, function (index) {
                addSuspectCard(suspectCards[index]);
            });

            var innocentSuspects = data.innocentSuspects;
            $.each(innocentSuspects, function (index) {
                disableSuspect(innocentSuspects[index]);
            });

            $("#clear").click();
        }

        function addSuspectCard(suspects) {
            var suspectsTemplate = $("#suspectsTemplate").html();
            var result = suspectsTemplate.format(suspects);
            $("#results").append(result);
        }

        function disableSuspect(suspect) {
            console.log(suspect);
            $("#suspects :checkbox[value='" + suspect + "']").attr("disabled", true);
        }

        function clearResults() {
            $("#results").empty();
        }

        String.prototype.format = function () {
            var args = arguments;
            return this.replace(/{(\d+)}/g, function (match, number) {
                return typeof args[number] != 'undefined' ? args[number] : match;
            });
        };
    </script>

    <script type="text/template" id="suspectsTemplate">
        <li class="list-group-item">{0}</li>
    </script>
</head>
<body>
<div class="container">
    <h1>Three Of A Crime</h1>
    <h4>Suspects</h4>

    <div id="suspects" class="btn-group" data-toggle="buttons-checkbox">
        <label label-default="label-default" class="checkbox-inline">
            <input type="checkbox" value="HUMPTY_BUMPTY"/>HUMPTY BUMPTY</label>
        <label label-default="label-default" class="checkbox-inline">
            <input type="checkbox" value="JONNY_CORTEX"/>JONNY CORTEX</label>
        <label label-default="label-default" class="checkbox-inline">
            <input type="checkbox" value="KID_CASSIDY"/>KID CASSIDY</label>
        <label label-default="label-default" class="checkbox-inline">
            <input type="checkbox" value="LOOSE_EYE_LENNY"/>LOOSE-EYE LENNY</label>
        <label label-default="label-default" class="checkbox-inline">
            <input type="checkbox" value="LOUIE_ST_LOUIS"/>LOUIE ST. LOUIS</label>
        <label label-default="label-default" class="checkbox-inline">
            <input type="checkbox" value="NO_NECK_NICK"/>NO NECK NICK</label>
        <label label-default="label-default" class="checkbox-inline">
            <input type="checkbox" value="PENCIL_TOP"/>PENCIL TOP</label>
    </div>
    <br/>
    <h4>Matches</h4>

    <div id="matches" class="btn-group" data-toggle="buttons-radio">
        <label label-default="label-default" class="radio-inline">
            <input type="radio" name="match" value="0"/>0</label>
        <label label-default="label-default" class="radio-inline">
            <input type="radio" name="match" value="1"/>1</label>
        <label label-default="label-default" class="radio-inline">
            <input type="radio" name="match" value="2"/>2</label>
    </div>
    <br/>
    <br/>
    <button id="submit" type="button" class="btn btn-success" disabled="disabled">Submit</button>
    <button id="clear" type="button" class="btn btn-warning">Clear</button>
    <button id="resetGame" type="button" class="btn btn-danger">Reset Game</button>
    <br/>
    <br/>

    <div class="row">
        <ul class="list-group">
            <div id="results"></div>
        </ul>
    </div>
    <div class="modal fade" id="confirm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">Start a new game?</h4>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button id="reset" type="button" class="btn btn-primary" data-dismiss="modal">Reset</button>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
