<!DOCTYPE html>
<html lang="en">
<head>
    <title>Three Of A Crime</title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <!--<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>-->
    <style type="text/css">
        body {
            margin-top: 20px;
        }
    </style>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#suspects").change(function () {
                checkSubmit();
            });

            $("#matches").change(function () {
                checkSubmit();
            });

            $("#clear").click(function () {
                $("#suspects :checked").each(function () {
                    $(this).removeAttr("checked");
                });
                checkSubmit();
            });

            $("#resetGame").click(function () {
                $.get('/play');
                $("#clear").click();
                clearResults();
            });

            $("#submit").click(function () {
                $.ajax({
                    type: 'POST',
                    url: '/play',
                    data: {
                        "matchedSuspects": $("#suspects :checked").map(function () {
                            return $(this).val();
                        }).get(),
                        "matches": $("#matches :checked").val()
                    },
                    dataType: "json",
                    success: displaySuspects,
                });
            });
        });

        function checkSubmit() {
            if ($("#suspects :checked").length == 3) {
                $("#suspects :not(:checked)").each(function () {
                    $(this).attr("disabled", true);
                });
                if ($("#matches :checked").length > 0) {
                    $("#submit").removeAttr("disabled");
                }
            } else {
                $("#submit").attr("disabled", true);
                $("#suspects :not(:checked)").each(function () {
                    $(this).removeAttr("disabled");
                });
            }
        }

        function displaySuspects(data, status, jqXHR) {
            clearResults();
            var suspectCards = data.suspectCards;
            $.each(suspectCards, function (index) {
                addSuspectCard(suspectCards[index]);
            });

            var innocentSuspects = data.innocentSuspects;
            $.each(innocentSuspects, function (index) {
                disableSuspect(innocentSuspects[index]);
            });

            $("#clear").click();
        }

        function addSuspectCard(suspects) {
            var suspectsTemplate = $("#suspectsTemplate").html();
            var result = suspectsTemplate.format(suspects);
            $("#results").append(result);
        }

        function disableSuspect(suspect) {
            // console.log(suspect);
            $("#suspects :checkbox[value='" + suspect + "']").attr("disabled", true);
        }

        function clearResults() {
            $("#results").empty();
        }

        String.prototype.format = function () {
            var args = arguments;
            return this.replace(/{(\d+)}/g, function (match, number) {
                return typeof args[number] != 'undefined' ? args[number] : match;
            });
        };
    </script>

    <script type="text/template" id="suspectsTemplate">
        {0}<br>
    </script>
</head>
<body>
<div class="container">
    <h2>Three Of A Crime</h2>

    <h4>Suspects</h4>

    <div id="suspects" class="btn-group" data-toggle="buttons-checkbox">
        <label class="checkbox-inline"><input type="checkbox" value="HUMPTY_BUMPTY">HUMPTY BUMPTY</label>
        <label class="checkbox-inline"><input type="checkbox" value="JONNY_CORTEX">JONNY CORTEX</label>
        <label class="checkbox-inline"><input type="checkbox" value="KID_CASSIDY">KID CASSIDY</label>
        <label class="checkbox-inline"><input type="checkbox" value="LOOSE_EYE_LENNY">LOOSE-EYE LENNY</label>
        <label class="checkbox-inline"><input type="checkbox" value="LOUIE_ST_LOUIS">LOUIE ST. LOUIS</label>
        <label class="checkbox-inline"><input type="checkbox" value="NO_NECK_NICK">NO NECK NICK</label>
        <label class="checkbox-inline"><input type="checkbox" value="PENCIL_TOP">PENCIL TOP</label>
    </div>
    <br>

    <h4>Matches</h4>

    <div id="matches" class="btn-group" data-toggle="buttons-radio">
        <label class="radio-inline"><input type="radio" name="match" value="0">0</label>
        <label class="radio-inline"><input type="radio" name="match" value="1">1</label>
        <label class="radio-inline"><input type="radio" name="match" value="2">2</label>
    </div>
    <br>
    <br>

    <button id="submit" type="button" class="btn btn-success" disabled>Submit</button>
    <button id="clear" type="button" class="btn btn-warning">Clear</button>
    <button id="resetGame" type="button" class="btn btn-danger">Reset Game</button>
    <br>
    <br>

    <div class="row">
        <div id="results">
        </div>
    </div>
</div>
</body>
</html>
